<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phenoarch platform - Cleaning procedure - Curve level - gss package • openSilexStatR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Phenoarch platform - Cleaning procedure - Curve level - gss package">
<meta property="og:description" content="openSilexStatR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openSilexStatR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CARBayesSTReport.html">Phenoarch platform - Cleaning procedure - Curve level - CARBayesST library</a>
    </li>
    <li>
      <a href="../articles/detectOutlierCurves.html">Phenoarch platform - Cleaning procedure - Curve level using SpATS</a>
    </li>
    <li>
      <a href="../articles/detectOutlierPoint.html">Phenoarch platform - Cleaning procedure - Point level using locfit</a>
    </li>
    <li>
      <a href="../articles/gssAnalysisReport.html">Phenoarch platform - Cleaning procedure - Curve level - gss package</a>
    </li>
    <li>
      <a href="../articles/videoImageGreenhouse.html">Phenoarch platform - Create a video of a trait in the plateform</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="gssAnalysisReport_files/header-attrs-2.3/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Phenoarch platform - Cleaning procedure - Curve level - gss package</h1>
                        <h4 class="author">I.Sanchez</h4>
            
            <h4 class="date">septembre 03, 2020</h4>
      
      
      <div class="hidden name"><code>gssAnalysisReport.Rmd</code></div>

    </div>

    
    
<!---
Program  : gssAnalysisReport.Rmd
Author   : I.Sanchez (MISTEA)
Objective: a vignette for phisStatR library
           Use of smoothing splines anova to detect outlier curve on each genotype-scenario
           of an experiment with the Kullback-Leibler projection
           require phisStatR library and fitgss() function
           This program produces a pdf report and some export files (CSV format) is necessary. 
           The user has to adapt to his own analysis.
Creation : 25/05/2020
Update   : 03/09/2020
-->
<hr>
<div id="objective-of-cleaning-procedure-using-smoothing-splines-anova" class="section level1">
<h1 class="hasAnchor">
<a href="#objective-of-cleaning-procedure-using-smoothing-splines-anova" class="anchor"></a>Objective of cleaning procedure using smoothing splines anova</h1>
<p>Smoothing spline analysis of variance on each genotype-scenario of an experiment. Detection of outlier repetition if significant TT*Rep (thermal time by repetition) interaction using a Kullblack-Leibler projection (KL). I consider a genotype-scenario as outlier:</p>
<ul>
<li>biovolume: if KL &gt; 0.05</li>
<li>plantHeight: if KL &gt; 0.05</li>
<li>leafArea: if KL &gt; 0.05</li>
</ul>
<p>The input dataset must contain the following columns:</p>
<ul>
<li>experimentAlias</li>
<li>genotypeAlias</li>
<li>scenario</li>
<li>repetition</li>
<li>thermalTime (for thermal time)</li>
<li>parameter of interest (biovolume, plantHeight etc…)</li>
</ul>
<p>The five first column names are standard names extracted from the web service.</p>
</div>
<div id="import-of-data" class="section level1">
<h1 class="hasAnchor">
<a href="#import-of-data" class="anchor"></a>Import of data</h1>
<div class="sourceCode" id="cb1"><html><body><pre class="r">  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gss</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">openSilexStatR</span>)

  <span class="no">myreport</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span>(<span class="fu"><a href="http://lubridate.tidyverse.org/reference/now.html">now</a></span>(),<span class="fl">1</span>,<span class="fl">10</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r">  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">plant3</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"-------------- plant3 dataset ---------------\n"</span>)</pre></body></html></div>
<pre><code>## -------------- plant3 dataset ---------------</code></pre>
<div class="sourceCode" id="cb4"><html><body><pre class="r">  <span class="fu"><a href="../reference/printExperiment.html">printExperiment</a></span>(<span class="kw">datain</span><span class="kw">=</span><span class="no">plant3</span>)</pre></body></html></div>
<pre><code>## Experiment: manip3 
## Genotypes: 10 
##  [1] "A3_H"     "A310_H"   "11430_H"  "A554_H"   "A374_H"   "A347_H"  
##  [7] "B100_H"   "A375_H"   "AS5707_H" "A347"    
## Scenario: 2 
## [1] "WW" "WD"
## Repetition-scenario: 6 
## [1] "1-WW" "2-WW" "3-WW" "1-WD" "2-WD" "3-WD"
## Pots (number of plants): 60 
## Line: 25 
## Position: 42</code></pre>
<div class="sourceCode" id="cb6"><html><body><pre class="r">  <span class="co"># Import data, here is a dataset in the phisStatR package, You have to import your own dataset</span>
  <span class="co"># using a read.table() statement or a request to the web service</span>
  <span class="co"># You can add some datamanagement statements...</span>
  <span class="co">#------------------------------------------------------------------------</span>
  <span class="co"># Please, add the 'Ref' and 'Genosce' columns if don't exist. </span>
  <span class="co"># 'Ref' is the concatenation of experimentAlias-Line-Position-scenario</span>
  <span class="co"># 'Genosce' is the concatenation of experimentAlias-genotypeAlias-scenario</span>
  <span class="co">#------------------------------------------------------------------------</span>

  <span class="no">mydata</span><span class="kw">&lt;-</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span>(<span class="no">plant3</span>,<span class="no">Genosce</span>,<span class="no">experimentAlias</span>,<span class="no">genotypeAlias</span>,<span class="no">scenario</span>,
                <span class="kw">sep</span><span class="kw">=</span><span class="st">"-"</span>,<span class="kw">remove</span><span class="kw">=</span><span class="fl">FALSE</span>)
  <span class="no">mydata</span><span class="kw">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">mydata</span>,<span class="no">Genosce</span>)</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r">  <span class="co"># For one parameter, for example biovolume</span>
  <span class="no">resbio</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/fitGSS.html">fitGSS</a></span>(<span class="kw">datain</span><span class="kw">=</span><span class="no">mydata</span>,<span class="kw">trait</span><span class="kw">=</span><span class="st">"biovolume"</span>,<span class="kw">loopId</span><span class="kw">=</span><span class="st">"Genosce"</span>)</pre></body></html></div>
</div>
<div id="curves-by-genotype-scenario" class="section level1">
<h1 class="hasAnchor">
<a href="#curves-by-genotype-scenario" class="anchor"></a>Curves by genotype-scenario</h1>
<div id="biovolume" class="section level2">
<h2 class="hasAnchor">
<a href="#biovolume" class="anchor"></a>Biovolume</h2>
<div class="sourceCode" id="cb8"><html><body><pre class="r">  <span class="no">outlierbio</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/printGSS.html">printGSS</a></span>(<span class="kw">object</span><span class="kw">=</span><span class="no">resbio</span>,<span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">0.05</span>)
  <span class="no">klbio</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/printGSS.html">printGSS</a></span>(<span class="kw">object</span><span class="kw">=</span><span class="no">resbio</span>,<span class="kw">threshold</span> <span class="kw">=</span> <span class="kw">NULL</span>)

  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"Detection of outlier curve with KL projection:\n"</span>)</pre></body></html></div>
<pre><code>## Detection of outlier curve with KL projection:</code></pre>
<div class="sourceCode" id="cb10"><html><body><pre class="r">  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">outlierbio</span>)</pre></body></html></div>
<pre><code>##              Genosce      ratio        kl     check
## 1  manip3-11430_H-WW 0.15015910 1175.7782 0.9999887
## 2 manip3-AS5707_H-WD 0.07205993  633.0729 0.9999874</code></pre>
<div class="sourceCode" id="cb12"><html><body><pre class="r">  #------------------------------------------------
  # You can export these two datasets
  # suppress the comments
  #------------------------------------------------
  #write.table(outlierbio,paste0(myreport,"outlier_gss_biovolume.csv"),
  #   row.names = FALSE,sep="\t")
  #write.table(klbio,paste0(myreport,"KLprojection_gss_biovolume.csv"),
  #   row.names = FALSE,sep="\t")</pre></body></html></div>
<p>I take a threshold of 0.05 for this example. We can take a more conservative threshold like 0.01 or 0.02 to detect more outlier curves…</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r">  <span class="co"># plot of the smoothing splines by genotype-scenario  </span>
  <span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">mydata</span>[,<span class="st">"Genosce"</span>])),<span class="kw">by</span><span class="kw">=</span><span class="fl">12</span>)){
    <span class="no">myvec</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="no">i</span>,<span class="no">i</span>+<span class="fl">11</span>,<span class="fl">1</span>)
    <span class="no">myvec</span><span class="kw">&lt;-</span><span class="no">myvec</span>[<span class="no">myvec</span><span class="kw">&lt;=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">mydata</span>[,<span class="st">"Genosce"</span>]))]
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="../reference/plotGSS.html">plotGSS</a></span>(<span class="kw">datain</span><span class="kw">=</span><span class="no">mydata</span>,<span class="kw">modelin</span><span class="kw">=</span><span class="no">resbio</span><span class="kw">[[</span><span class="fl">1</span>]],<span class="kw">trait</span><span class="kw">=</span><span class="st">"biovolume"</span>,
                  <span class="kw">myvec</span><span class="kw">=</span><span class="no">myvec</span>,<span class="kw">lgrid</span><span class="kw">=</span><span class="fl">50</span>))
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"\n\n"</span>)
  }</pre></body></html></div>
<p><img src="gssAnalysisReport_files/figure-html/graph-1.png" width="1152"></p>
<p><img src="gssAnalysisReport_files/figure-html/graph-2.png" width="1152"></p>
</div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 18363)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252   
## [3] LC_MONETARY=French_France.1252 LC_NUMERIC=C                  
## [5] LC_TIME=French_France.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] openSilexStatR_1.1.0 gss_2.2-2            dplyr_1.0.0         
## [4] tidyr_1.1.0          lubridate_1.7.9      ggplot2_3.3.2       
## 
## loaded via a namespace (and not attached):
##  [1] nlme_3.1-148       matrixStats_0.56.0 fs_1.4.2           sf_0.9-5          
##  [5] gmodels_2.18.1     RColorBrewer_1.1-2 rprojroot_1.3-2    evd_2.3-3         
##  [9] CARBayesdata_2.1   tools_4.0.2        backports_1.1.8    rgdal_1.5-12      
## [13] R6_2.4.1           KernSmooth_2.23-17 spData_0.3.8       DBI_1.1.0         
## [17] colorspace_1.4-1   raster_3.3-13      withr_2.2.0        CARBayesST_3.1    
## [21] sp_1.4-2           tidyselect_1.1.0   gridExtra_2.3      GGally_2.0.0      
## [25] leaflet_2.0.3      compiler_4.0.2     expm_0.999-5       desc_1.2.0        
## [29] labeling_0.3       scales_1.1.1       classInt_0.4-3     pkgdown_1.5.1     
## [33] stringr_1.4.0      digest_0.6.25      foreign_0.8-80     rmarkdown_2.3     
## [37] pkgconfig_2.0.3    htmltools_0.5.0    htmlwidgets_1.5.1  rlang_0.4.7       
## [41] rstudioapi_0.11    generics_0.0.2     farver_2.0.3       crosstalk_1.1.0.1 
## [45] gtools_3.8.2       spdep_1.1-5        magrittr_1.5       shapefiles_0.7    
## [49] dotCall64_1.0-0    Matrix_1.2-18      Rcpp_1.0.5         munsell_0.5.0     
## [53] lifecycle_0.2.0    truncdist_1.0-2    stringi_1.4.6      yaml_2.2.1        
## [57] MASS_7.3-51.6      plyr_1.8.6         matrixcalc_1.0-3   grid_4.0.2        
## [61] gdata_2.18.0       crayon_1.3.4       deldir_0.1-28      lattice_0.20-41   
## [65] splines_4.0.2      knitr_1.29         pillar_1.4.6       boot_1.3-25       
## [69] codetools_0.2-16   stats4_4.0.2       LearnBayes_2.15.1  glue_1.4.1        
## [73] evaluate_0.14      data.table_1.13.0  vctrs_0.3.2        spam_2.5-1        
## [77] testthat_2.3.2     gtable_0.3.0       purrr_0.3.4        reshape_0.8.8     
## [81] assertthat_0.2.1   xfun_0.16          SpATS_1.0-11       e1071_1.7-3       
## [85] coda_0.19-3        class_7.3-17       truncnorm_1.0-8    tibble_3.0.3      
## [89] memoise_1.1.0      units_0.6-7        ellipsis_0.3.1</code></pre>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ol style="list-style-type: decimal">
<li>R Development Core Team (2015). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. ISBN 3-900051-07-0, URL <a href="http://www.R-project.org" class="uri">http://www.R-project.org</a>.</li>
<li>Chong Gu (2014). Smoothing Spline ANOVA Models: R Package gss. Journal of Statistical Software, 58(5), 1-25. URL <a href="http://www.jstatsoft.org/v58/i05/" class="uri">http://www.jstatsoft.org/v58/i05/</a>.</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Pascal Neveu, Nadine Hilgert, Isabelle Sanchez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
